{% extends "base.html" %}

{% block title %}Staff Administration - Vital Signs{% endblock %}

{% block content %}
{% if not session.get('is_admin') %}
<!-- Admin Login -->
<div class="card animate-fade-in" style="max-width: 500px; margin: 0 auto;">
    <div class="card-header">
        <h2>ğŸ‘¤ Staff Administration Login</h2>
    </div>
    <div class="card-body">
        <p class="text-muted mb-3">
            Admin credentials required to manage staff records.
        </p>
        
        <form method="POST" action="{{ url_for('staff_admin') }}">
            <input type="hidden" name="action" value="login">
            
            <div class="form-group">
                <label class="form-label required">Admin Staff Number</label>
                <input type="text" name="admin_number" class="form-input" 
                       placeholder="e.g., ADMIN001" required>
            </div>
            
            <div class="form-group">
                <label class="form-label required">Admin Last Name</label>
                <input type="text" name="admin_last" class="form-input" 
                       placeholder="Your last name" required>
            </div>
            
            <button type="submit" class="btn btn-primary btn-lg btn-block">
                ğŸ”“ Login as Admin
            </button>
        </form>
        
        <div class="mt-3 text-center">
            <p class="text-muted">
                <small>
                    ğŸ’¡ <strong>Default Admin:</strong> Staff Number: <code>ADMIN001</code>, 
                    Last Name: <code>Administrator</code>
                </small>
            </p>
        </div>
    </div>
</div>

{% else %}
<!-- Admin Dashboard -->
<div class="card animate-fade-in">
    <div class="card-header">
        <div class="d-flex justify-between align-center flex-wrap gap-2">
            <div>
                <h2>ğŸ‘¥ Staff Administration</h2>
                <p style="opacity: 0.9; margin-top: 0.25rem;">
                    Logged in as: {{ session.get('admin_name', 'Admin') }}
                </p>
            </div>
            <a href="{{ url_for('logout') }}" class="btn btn-secondary">
                ğŸšª Logout
            </a>
        </div>
    </div>
    <div class="card-body">
        <!-- Add New Staff Form -->
        <div class="mb-4">
            <h4 class="mb-3">â• Add New Staff Member</h4>
            <form method="POST" action="{{ url_for('staff_admin') }}" 
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: end;">
                <input type="hidden" name="action" value="add_staff">
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label required">Staff Number</label>
                    <input type="text" name="staff_number" class="form-input" 
                           placeholder="e.g., STAFF001" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label required">First Name</label>
                    <input type="text" name="first_name" class="form-input" 
                           placeholder="First name" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label required">Last Name</label>
                    <input type="text" name="last_name" class="form-input" 
                           placeholder="Last name" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" name="is_admin">
                        Admin Privileges
                    </label>
                </div>
                
                <button type="submit" class="btn btn-success">
                    â• Add Staff
                </button>
            </form>
        </div>
        
        <hr class="mb-4">
        
        <!-- Staff List -->
        <h4 class="mb-3">ğŸ“‹ Current Staff Members</h4>
        
        {% if staff_list %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Staff Number</th>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for staff in staff_list %}
                    <tr>
                        <td><strong>{{ staff.staff_number }}</strong></td>
                        <td>{{ staff.first_name }} {{ staff.last_name }}</td>
                        <td>
                            {% if staff.is_admin %}
                            <span class="staff-badge badge-admin">Admin</span>
                            {% else %}
                            <span class="staff-badge badge-staff">Staff</span>
                            {% endif %}
                        </td>
                        <td>{{ staff.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('staff_admin') }}" 
                                  style="display: inline;"
                                  onsubmit="return confirm('Are you sure you want to delete this staff member?');">
                                <input type="hidden" name="action" value="delete_staff">
                                <input type="hidden" name="staff_id" value="{{ staff.id }}">
                                <button type="submit" class="btn btn-danger btn-sm">
                                    ğŸ—‘ï¸ Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center" style="padding: 2rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¥</div>
            <p class="text-muted">No staff members found. Add your first staff member above.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Help Section -->
<div class="card mt-3 animate-fade-in" style="animation-delay: 0.2s;">
    <div class="card-body">
        <h5>ğŸ“– Staff Management Guide</h5>
        <div class="patient-info-grid">
            <div class="info-item">
                <div class="label">Staff Numbers</div>
                <div class="value" style="font-size: 1rem;">
                    Unique identifiers for each staff member (e.g., STAFF001, DR001, NURSE001)
                </div>
            </div>
            <div class="info-item">
                <div class="label">Admin Privileges</div>
                <div class="value" style="font-size: 1rem;">
                    Admins can manage staff accounts. Regular staff can only access patient records.
                </div>
            </div>
            <div class="info-item">
                <div class="label">Authentication</div>
                <div class="value" style="font-size: 1rem;">
                    Staff authenticate using their staff number and last name.
                </div>
            </div>
            <div class="info-item">
                <div class="label">Physicians</div>
                <div class="value" style="font-size: 1rem;">
                    Staff numbers are used to assign physicians to patients.
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
